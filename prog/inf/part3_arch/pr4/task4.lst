GAS LISTING task4.S 			page 1


   1              	/*
   2              	 * ÐŸÑ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð° Ð²Ñ‹Ñ‡Ð¸ÑÐ»ÐµÐ½Ð¸Ñ Ð¸ Ð²Ñ‹Ð²Ð¾Ð´Ð° ÑÑƒÐ¼Ð¼Ñ‹ Ð¾Ð´Ð½Ð¾Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ñ‹Ñ… Ñ‡Ð¸
   3              	 * ÐšÐ°Ðº Ð¼Ð¾Ð¶Ð½Ð¾ Ð·Ð°Ñ‚ÐµÑÑ‚Ð¸Ñ‚ÑŒ Ð±ÐµÐ· Ñ€ÑƒÑ‡Ð½Ð¾Ð³Ð¾ Ð²Ð²Ð¾Ð´Ð° Ð² stdin?
   4              	 * echo -e "5\n9\n1\n" | ./sum_digits
   5              	 */
   6              	
   7              	.include "my-macro"
   1              	/*
   2              	 * ÐœÐ°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹.
   3              	 * ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
   4              	 *     - ÐºÐ¾Ð´ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹
   5              	 *
   6              	 * ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð° Ð¸Ð·Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñ‹: %e
   7              	 * Ð¡Ð¼. Ñ‚Ð°ÐºÐ¶Ðµ 'man 2 exit'
   8              	*/
   9              	.macro Exit ret_val
  10              	    movl $1, %eax         # Ð½Ð¾Ð¼ÐµÑ€ ÑÐ¸ÑÑ‚. Ð²Ñ‹Ð·Ð¾Ð²Ð° exit
  11              	    movl \ret_val, %ebx     # ÐºÐ¾Ð´ Ð²Ñ‹Ñ…Ð¾Ð´Ð°
  12              	    int $0x80         # Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð²
  13              	.endm
  14              	
  15              	
  16              	/*
  17              	 * ÐœÐ°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð±Ð°Ð¹Ñ‚Ð° ÐºÐ¾Ð´Ð° Ñ
  18              	 * ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð²Ð²Ð¾Ð´Ð°
  19              	 * ÐÐµÐºÐ°Ñ Ð°Ð±ÑÑ‚Ñ€Ð°ÐºÑ†Ð¸Ñ Ð½Ð°Ð´ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¼ Ð²Ñ‹Ð·Ð¾Ð²Ð¾Ð¼ Linux read, Ð¿Ñ€ÐµÐ´Ð½Ð
  20              	 * ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
  21              	 *     - Ð°Ð´Ñ€ÐµÑ Ð±ÑƒÑ„ÐµÑ€Ð° Ð´Ð»Ñ ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ Ð±Ð°Ð¹Ñ‚Ð°
  22              	 * Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:
  23              	 *    - Ð² %eax ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÑ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ‹Ñ… Ð±Ð°Ð¹Ñ‚Ð¾Ð²
  24              	 *    - Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ buf_addr - ÑÑ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ‹Ð¹ Ð±Ð°Ð¹Ñ‚
  25              	 *
  26              	 * ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð° Ð¸Ð·Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñ‹: %e
  27              	 * Ð¡Ð¼. Ñ‚Ð°ÐºÐ¶Ðµ 'man 2 read'
  28              	*/
  29              	.macro Getchar buf_addr
  30              	    movl $3, %eax        # Ð½Ð¾Ð¼ÐµÑ€ ÑÐ¸ÑÑ‚. Ð²Ñ‹Ð·Ð¾Ð²Ð° read
  31              	    movl $0, %ebx        # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 1: Ð´ÐµÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ñ€ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð²Ð²Ð¾
  32              	    movl \buf_addr, %ecx    # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 2: Ð°Ð´Ñ€ÐµÑ Ð±ÑƒÑ„ÐµÑ€Ð° (Ð¾Ð½ Ð¶Ðµ - Ñ„Ð°ÐºÑ‚Ð¸Ñ‡
  33              	                     # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð°)
  34              	    movl $1, %edx        # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 3: ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð±Ð°Ð¹Ñ‚Ð¾Ð² Ð´Ð»Ñ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ
  35              	    int $0x80        # Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð²
  36              	.endm
  37              	
  38              	/*
  39              	 * ÐœÐ°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ  Ð²Ñ‹Ð²Ð¾Ð´Ð° ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð² Ñ„Ð°Ð¹Ð» ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð
  40              	 * ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
  41              	 *     - Ð¡Ñ‚Ñ€Ð¾ÐºÐ° Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð°.
  42              	 *
  43              	 * ÐŸÑ€Ð¸Ð¼ÐµÑ‚Ñ€ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð°:
  44              	 *    Puts "Ð¢ÐµÐºÑÑ‚ Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ð¼Ð¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐ¸"
  45              	 *
  46              	 * Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:
  47              	 *    - Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ñ‚ Ð² ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ð¹ Ð²Ñ‹Ð²Ð¾Ð´ ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ‹ Ð·Ð°Ð´Ð°Ð½Ð½Ð¾Ð¹ ÑÑ‚Ñ€Ð
  48              	 *      Ð¸ Ð²ÑÐ»ÐµÐ´ Ð·Ð° Ð½Ð¸Ð¼Ð¸ ÑÐ¸Ð¼Ð²Ð¾Ð» Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð° ÑÑ‚Ñ€Ð¾ÐºÐ¸ \n
  49              	 *
  50              	 * ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð° Ð¸Ð·Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñ‹: %e
GAS LISTING task4.S 			page 2


  51              	 * Ð¡Ð¼. Ñ‚Ð°ÐºÐ¶Ðµ 'man puts', 'man 2 write'
  52              	*/
  53              	.macro Puts string
  54              	.data
  55              	    str\@:     .ascii "\string\n"  # Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ„Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð
  56              	
  57              	    strlen\@ =     . - str\@           # Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð´Ð»Ð¸Ð½Ñ‹ ÑÑ‚Ñ€Ð¾ÐºÐ
  58              	
  59              	.text
  60              	    movl $4, %eax        # Ð½Ð¾Ð¼ÐµÑ€ ÑÐ¸ÑÑ‚. Ð²Ñ‹Ð·Ð¾Ð²Ð° write
  61              	    movl $1, %ebx        # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 1: Ð´ÐµÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ñ€ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð²Ñ‹Ð²
  62              	    movl $str\@, %ecx    # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 2: Ð°Ð´Ñ€ÐµÑ Ð¿Ð°Ð¼ÑÑ‚Ð¸ Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ð¼Ñ‹Ð¼Ð¸ ÑÐ¸
  63              	    movl $strlen\@, %edx     # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 3: ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð±Ð°Ð¹Ñ‚Ð¾Ð² Ð´Ð»Ñ Ð²Ñ‹Ð²Ð
  64              	    int $0x80        # Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð²
  65              	.endm
   8              	
   9              	.bss
  10              	    .lcomm c, 1                 # Ð±ÑƒÑ„ÐµÑ€ Ð´Ð»Ñ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð±Ð°Ð¹Ñ‚Ð° Ð¸Ð· stdin
  11              	    .lcomm last_digit, 1        # Ð±ÑƒÑ„ÐµÑ€ Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¹ Ð²Ð²ÐµÐ´ÐµÐ
  12              	    .lcomm output_buf, 6        # Ð±ÑƒÑ„ÐµÑ€ Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð° Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð° (Ð¼Ð°ÐºÑ 5 Ñ
  13              	
  14              	.data
  15 0000 0000     	    sum: .word 0                # 2-Ð±Ð°Ð¹Ñ‚Ð¾Ð²Ð°Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ñ
  16              	
  17              	.text
  18              	.global _start
  19              	
  20              	_start:
  21 0000 90       	    nop                         # Ð´Ð»Ñ Ð¾Ñ‚Ð»Ð°Ð´Ñ‡Ð¸ÐºÐ°
  22              	
  23 0001 66C70500 	    movw $0, sum                # Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÑƒÐ¼Ð¼Ñ‹ = 0
  23      00000000 
  23      00
  24 000a C6050100 	    movb $0, last_digit         # Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¹ Ñ†Ð¸Ñ„Ñ€Ñ‹
  24      000000
  25              	
  26              	    Puts "Ð’Ð²Ð¾Ð´Ð¸Ñ‚Ðµ Ñ†Ð¸Ñ„Ñ€Ñ‹ Ð¸ Ð¶Ð¼Ð¸Ñ‚Ðµ Enter Ð¿Ð¾ÑÐ»Ðµ ÐºÐ°Ð¶Ð´Ð¾Ð¹. Ð”Ð»Ñ Ð·Ð°Ð²ÐµÑ€Ñ
  26              	> .data
  26 0002 D092D0B2 	>  str0:.ascii "Ð’Ð²Ð¾Ð´Ð¸Ñ‚Ðµ Ñ†Ð¸Ñ„Ñ€Ñ‹ Ð¸ Ð¶Ð¼Ð¸Ñ‚Ðµ Enter Ð¿Ð¾ÑÐ»Ðµ ÐºÐ°Ð¶Ð´Ð¾Ð¹. Ð”Ð»Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ: Ctrl+D\n"
  26      D0BED0B4 
  26      D0B8D182 
  26      D0B520D1 
  26      86D0B8D1 
  26              	> 
  26              	>  strlen0 =. - str0
  26              	> 
  26              	> .text
  26 0011 B8040000 	>  movl $4,%eax
  26      00
  26 0016 BB010000 	>  movl $1,%ebx
  26      00
  26 001b B9020000 	>  movl $str0,%ecx
  26      00
  26 0020 BA6B0000 	>  movl $strlen0,%edx
  26      00
  26 0025 CD80     	>  int $0x80
  27              	
GAS LISTING task4.S 			page 3


  28              	kbd_input:
  29              	    Getchar $c                  # Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð² Ð²Ð²Ð¾Ð´Ð° Ð±Ð°Ð¹Ñ‚Ð° Ð¸Ð· stdin
  29 0027 B8030000 	>  movl $3,%eax
  29      00
  29 002c BB000000 	>  movl $0,%ebx
  29      00
  29 0031 B9000000 	>  movl $c,%ecx
  29      00
  29              	>  
  29 0036 BA010000 	>  movl $1,%edx
  29      00
  29 003b CD80     	>  int $0x80
  30              	
  31 003d 83F800   	    cmpl $0, %eax               # Ð½Ð°ÑÑ‚ÑƒÐ¿Ð¸Ð»Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ EOF?
  32 0040 0F840101 	    je print_result             # Ð”Ð - Ð²Ñ‹Ð²ÐµÑÑ‚Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¸ Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑŒ
  32      0000
  33              	
  34 0046 803D0000 	    cmpb $'\n', c               # ÑÑ‚Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð» Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð° ÑÑ‚Ñ€Ð¾ÐºÐ¸ (Enter)?
  34      00000A
  35 004d 741E     	    je process_enter            # Ð”Ð - Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Enter Ð¸ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ðº ÑÑƒÐ¼Ð¼
  36              	
  37 004f 803D0000 	    cmpb $'9', c                # ÐºÐ¾Ð´ Ð±Ð¾Ð»ÑŒÑˆÐµ ÐºÐ¾Ð´Ð° ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° '9'?
  37      000039
  38 0056 77CF     	    ja kbd_input                # Ð”Ð - Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼ (Ð½Ðµ Ñ†Ð¸Ñ„Ñ€Ð°)
  39              	
  40 0058 803D0000 	    cmpb $'0', c                # ÐºÐ¾Ð´ Ð¼ÐµÐ½ÑŒÑˆÐµ ÐºÐ¾Ð´Ð° ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° '0'?
  40      000030
  41 005f 72C6     	    jb kbd_input                # Ð”Ð - Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼ (Ð½Ðµ Ñ†Ð¸Ñ„Ñ€Ð°)
  42              	
  43              	    # ÐÐ³Ð°, ÑÑ‚Ð¾ Ñ†Ð¸Ñ„Ñ€Ð° - ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ ÐµÑ‘ ÐºÐ°Ðº Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ. Ð•ÑÐ»Ð¸ Ð½ÐµÑ
  44 0061 A0000000 	    movb c, %al                 # Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‚ÑŒ ÐºÐ¾Ð´ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° Ñ†Ð¸Ñ„Ñ€Ñ‹ Ð¸Ð· c Ð² al
  44      00
  45 0066 A2010000 	    movb %al, last_digit        # ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð²Ð²ÐµÐ´ÐµÐ½Ð½ÑƒÑŽ Ñ†Ð¸Ñ„Ñ€
  45      00
  46              	
  47 006b EBBA     	    jmp kbd_input               # Ð½Ð° Ð²Ð²Ð¾Ð´ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°
  48              	
  49              	process_enter:
  50              	    # ÐŸÑ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð´Ð° ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° Ð² Ñ‡Ð¸ÑÐ»Ð¾Ð²Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ
  51 006d 0FB60501 	    movzbl last_digit, %eax     # Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÐºÐ¾Ð´ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¹ Ñ†Ð¸Ñ„Ñ€Ñ‹ Ð² eax
  51      000000
  52              	
  53              	    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°: Ð±Ñ‹Ð»Ð° Ð»Ð¸ Ð²Ð²ÐµÐ´ÐµÐ½Ð° Ñ…Ð¾Ñ‚Ñ Ð±Ñ‹ Ð¾Ð´Ð½Ð° Ñ†Ð¸Ñ„Ñ€Ð°
  54 0074 83F800   	    cmpl $0, %eax               # ÐµÑÐ»Ð¸ ÐºÐ¾Ð´ = 0, Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ Ñ†Ð¸Ñ„Ñ€Ñ‹ Ð½Ðµ Ð±Ñ‹Ð»Ð¾
  55 0077 74AE     	    je kbd_input                # Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð¿ÑƒÑÑ‚Ð¾Ð¹ Enter
  56              	
  57 0079 83E830   	    subl $'0', %eax             # Ð²Ñ‹Ñ‡ÐµÑÑ‚ÑŒ ÐºÐ¾Ð´ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° '0' - Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð¼ Ñ‡Ð¸ÑÐ
  58              	
  59              	    # Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ðº ÑÑƒÐ¼Ð¼Ðµ Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¾Ð¹ Ð¿ÐµÑ€ÐµÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ
  60              	    # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ 16-Ð±Ð¸Ñ‚Ð½Ð¾Ðµ ÑÐ»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
  61 007c 0FB71D00 	    movzwl sum, %ebx            # Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰ÑƒÑŽ ÑÑƒÐ¼Ð¼Ñƒ Ð² ebx (Ñ Ð½ÑƒÐ»ÐµÐ
  61      000000
  62 0083 01C3     	    addl %eax, %ebx             # Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‡Ð¸ÑÐ»Ð¾Ð²Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ñ†Ð¸Ñ„Ñ€Ñ‹
  63              	
  64              	    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿ÐµÑ€ÐµÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ 16-Ð±Ð¸Ñ‚Ð½Ð¾Ð³Ð¾ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ
  65 0085 81FBFFFF 	    cmpl $65535, %ebx           # Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ð½Ðµ Ð¿Ñ€ÐµÐ²Ñ‹ÑÐ¸Ð»Ð¸ Ð»Ð¸ 65535
  65      0000
GAS LISTING task4.S 			page 4


  66 008b 772E     	    ja overflow_detected        # ÐµÑÐ»Ð¸ Ð±Ð¾Ð»ÑŒÑˆÐµ - Ð¿ÐµÑ€ÐµÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ
  67              	
  68 008d 66891D00 	    movw %bx, sum               # ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð½Ð¾Ð²ÑƒÑŽ ÑÑƒÐ¼Ð¼Ñƒ (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¼Ð»Ð°Ð´Ñˆ
  68      000000
  69              	
  70 0094 C6050100 	    movb $0, last_digit         # ÑÐ±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ñ†Ð¸Ñ„Ñ€Ñƒ
  70      000000
  71              	
  72              	    Puts "ÐŸÑ€Ð¾Ð¼ÐµÐ¶ÑƒÑ‚Ð¾Ñ‡Ð½Ð°Ñ ÑÑƒÐ¼Ð¼Ð°:"
  72              	> .data
  72 006d D09FD180 	>  str2:.ascii "ÐŸÑ€Ð¾Ð¼ÐµÐ¶ÑƒÑ‚Ð¾Ñ‡Ð½Ð°Ñ ÑÑƒÐ¼Ð¼Ð°:\n"
  72      D0BED0BC 
  72      D0B5D0B6 
  72      D183D182 
  72      D0BED187 
  72              	> 
  72              	>  strlen2 =. - str2
  72              	> 
  72              	> .text
  72 009b B8040000 	>  movl $4,%eax
  72      00
  72 00a0 BB010000 	>  movl $1,%ebx
  72      00
  72 00a5 B96D0000 	>  movl $str2,%ecx
  72      00
  72 00aa BA270000 	>  movl $strlen2,%edx
  72      00
  72 00af CD80     	>  int $0x80
  73              	    # Ð’Ñ‹Ð²ÐµÑÑ‚Ð¸ Ñ‚ÐµÐºÑƒÑ‰ÑƒÑŽ ÑÑƒÐ¼Ð¼Ñƒ
  74 00b1 E8270000 	    call print_current_sum
  74      00
  75              	
  76 00b6 E96CFFFF 	    jmp kbd_input               # Ð½Ð° Ð²Ð²Ð¾Ð´ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°
  76      FF
  77              	
  78              	overflow_detected:
  79              	    Puts "ÐŸÐµÑ€ÐµÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ! Ð¡ÑƒÐ¼Ð¼Ð° Ð¿Ñ€ÐµÐ²Ñ‹ÑÐ¸Ð»Ð° 65535"
  79              	> .data
  79 0094 D09FD0B5 	>  str3:.ascii "ÐŸÐµÑ€ÐµÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ! Ð¡ÑƒÐ¼Ð¼Ð° Ð¿Ñ€ÐµÐ²Ñ‹ÑÐ¸Ð»Ð° 65535\n"
  79      D180D0B5 
  79      D0BFD0BE 
  79      D0BBD0BD 
  79      D0B5D0BD 
  79              	> 
  79              	>  strlen3 =. - str3
  79              	> 
  79              	> .text
  79 00bb B8040000 	>  movl $4,%eax
  79      00
  79 00c0 BB010000 	>  movl $1,%ebx
  79      00
  79 00c5 B9940000 	>  movl $str3,%ecx
  79      00
  79 00ca BA3E0000 	>  movl $strlen3,%edx
  79      00
  79 00cf CD80     	>  int $0x80
  80              	    Exit $1                     # Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñƒ Ñ ÐºÐ¾Ð´Ð¾Ð¼ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ 
GAS LISTING task4.S 			page 5


  80 00d1 B8010000 	>  movl $1,%eax
  80      00
  80 00d6 BB010000 	>  movl $1,%ebx
  80      00
  80 00db CD80     	>  int $0x80
  81              	
  82              	# ÐŸÐ¾Ð´Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð° Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð° Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ ÑÑƒÐ¼Ð¼Ñ‹
  83              	print_current_sum:
  84              	    # Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñ‹
  85 00dd 50       	    pushl %eax
  86 00de 53       	    pushl %ebx
  87 00df 51       	    pushl %ecx
  88 00e0 52       	    pushl %edx
  89 00e1 57       	    pushl %edi
  90              	
  91              	    # ÐŸÑ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÑƒÐ¼Ð¼Ñ‹ Ð² ÑÑ‚Ñ€Ð¾ÐºÑƒ
  92 00e2 0FB70500 	    movzwl sum, %eax            # Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÑÑƒÐ¼Ð¼Ñƒ Ð² eax
  92      000000
  93 00e9 BF040000 	    movl $output_buf, %edi      # ÑƒÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ð° Ð½Ð°Ñ‡Ð°Ð»Ð¾ Ð±ÑƒÑ„ÐµÑ€Ð° Ð²Ñ‹Ð²Ð¾Ð´Ð°
  93      00
  94 00ee B90A0000 	    movl $10, %ecx              # Ð´ÐµÐ»Ð¸Ñ‚ÐµÐ»ÑŒ = 10
  94      00
  95              	
  96              	    # Ð¡Ð¿ÐµÑ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐ»ÑƒÑ‡Ð°Ð¹: ÐµÑÐ»Ð¸ ÑÑƒÐ¼Ð¼Ð° = 0
  97 00f3 83F800   	    cmpl $0, %eax
  98 00f6 7506     	    jne convert_sum_loop
  99              	
 100              	    # Ð’Ñ‹Ð²Ð¾Ð´ "0" ÐµÑÐ»Ð¸ ÑÑƒÐ¼Ð¼Ð° Ñ€Ð°Ð²Ð½Ð° 0
 101 00f8 C60730   	    movb $'0', (%edi)
 102 00fb 47       	    incl %edi
 103 00fc EB25     	    jmp add_newline_sum
 104              	
 105              	convert_sum_loop:
 106 00fe BB000000 	    movl $0, %ebx               # Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÑ‡ÐµÑ‚Ñ‡Ð¸ÐºÐ° Ñ†Ð¸Ñ„Ñ€
 106      00
 107              	
 108              	convert_sum_loop_body:
 109              	    # Ð”ÐµÐ»Ð¸Ð¼ Ñ‡Ð¸ÑÐ»Ð¾ Ð½Ð° 10, Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº (Ñ†Ð¸Ñ„Ñ€Ñƒ)
 110 0103 BA000000 	    movl $0, %edx               # Ð¾Ð±Ð½ÑƒÐ»ÑÐµÐ¼ edx Ð¿ÐµÑ€ÐµÐ´ Ð´ÐµÐ»ÐµÐ½Ð¸ÐµÐ¼
 110      00
 111 0108 F7F1     	    divl %ecx                   # eax = eax / 10, edx = Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº
 112              	
 113              	    # ÐŸÑ€ÐµÐ¾Ð±Ñ€Ð°Ð·ÑƒÐµÐ¼ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº Ð² ÑÐ¸Ð¼Ð²Ð¾Ð» Ð¸ Ð¿Ð¾Ð¼ÐµÑ‰Ð°ÐµÐ¼ Ð² ÑÑ‚ÐµÐº
 114 010a 83C230   	    addl $'0', %edx             # Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ†Ð¸Ñ„Ñ€Ñƒ Ð² ÐºÐ¾Ð´ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°
 115 010d 52       	    pushl %edx                  # ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð² ÑÑ‚ÐµÐº
 116              	
 117 010e 43       	    incl %ebx                   # ÑÑ‡ÐµÑ‚Ñ‡Ð¸Ðº Ñ†Ð¸Ñ„Ñ€
 118              	
 119 010f 83F800   	    cmpl $0, %eax               # Ñ‡Ð°ÑÑ‚Ð½Ð¾Ðµ = 0?
 120 0112 75EF     	    jne convert_sum_loop_body   # ÐÐ•Ð¢ - Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÐ¼ Ð´ÐµÐ»ÐµÐ½Ð¸Ðµ
 121              	
 122              	    # Ð˜Ð·Ð²Ð»ÐµÐºÐ°ÐµÐ¼ Ñ†Ð¸Ñ„Ñ€Ñ‹ Ð¸Ð· ÑÑ‚ÐµÐºÐ° Ð² Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð¼ Ð¿Ð¾Ñ€ÑÐ´ÐºÐµ
 123 0114 BF040000 	    movl $output_buf, %edi      # ÑƒÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ð° Ð½Ð°Ñ‡Ð°Ð»Ð¾ Ð±ÑƒÑ„ÐµÑ€Ð°
 123      00
 124              	
 125              	extract_sum_digits:
 126 0119 58       	    popl %eax                   # Ð¸Ð·Ð²Ð»ÐµÐºÐ°ÐµÐ¼ ÐºÐ¾Ð´ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° Ð¸Ð· ÑÑ‚ÐµÐºÐ°
GAS LISTING task4.S 			page 6


 127 011a 8807     	    movb %al, (%edi)            # Ð·Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÐ¼ Ð² Ð±ÑƒÑ„ÐµÑ€
 128 011c 47       	    incl %edi                   # ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð°Ñ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ Ð² Ð±ÑƒÑ„ÐµÑ€Ðµ
 129 011d 4B       	    decl %ebx                   # ÑƒÐ¼ÐµÐ½ÑŒÑˆÐ°ÐµÐ¼ ÑÑ‡ÐµÑ‚Ñ‡Ð¸Ðº
 130 011e 83FB00   	    cmpl $0, %ebx               # Ð²ÑÐµ Ñ†Ð¸Ñ„Ñ€Ñ‹ Ð¸Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ñ‹?
 131 0121 75F6     	    jne extract_sum_digits      # ÐÐ•Ð¢ - Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÐ¼
 132              	
 133              	add_newline_sum:
 134 0123 C6070A   	    movb $'\n', (%edi)          # Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´ ÑÑ‚Ñ€Ð¾ÐºÐ¸
 135 0126 47       	    incl %edi                   # ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°ÐµÐ¼ ÑƒÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒ
 136              	
 137              	    # Ð’Ñ‹Ñ‡Ð¸ÑÐ»ÑÐµÐ¼ Ð´Ð»Ð¸Ð½Ñƒ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð°
 138 0127 B8040000 	    movl $output_buf, %eax      # Ð½Ð°Ñ‡Ð°Ð»Ð¾ Ð±ÑƒÑ„ÐµÑ€Ð°
 138      00
 139 012c 89FA     	    movl %edi, %edx             # Ñ‚ÐµÐºÑƒÑ‰Ð°Ñ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ (ÐºÐ¾Ð½ÐµÑ† ÑÑ‚Ñ€Ð¾ÐºÐ¸)
 140 012e 29C2     	    subl %eax, %edx             # Ð´Ð»Ð¸Ð½Ð° = ÐºÐ¾Ð½ÐµÑ† - Ð½Ð°Ñ‡Ð°Ð»Ð¾
 141              	
 142              	    # Ð’Ñ‹Ð²Ð¾Ð´ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°
 143 0130 B8040000 	    movl $4, %eax               # Ð½Ð¾Ð¼ÐµÑ€ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð²Ñ‹Ð·Ð¾Ð²Ð° write
 143      00
 144 0135 BB010000 	    movl $1, %ebx               # Ð´ÐµÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ñ€ stdout
 144      00
 145 013a B9040000 	    movl $output_buf, %ecx      # Ð°Ð´Ñ€ÐµÑ Ð±ÑƒÑ„ÐµÑ€Ð°
 145      00
 146              	    # edx ÑƒÐ¶Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð´Ð»Ð¸Ð½Ñƒ
 147 013f CD80     	    int $0x80                   # Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð²
 148              	
 149              	    # Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñ‹
 150 0141 5F       	    popl %edi
 151 0142 5A       	    popl %edx
 152 0143 59       	    popl %ecx
 153 0144 5B       	    popl %ebx
 154 0145 58       	    popl %eax
 155              	
 156 0146 C3       	    ret
 157              	
 158              	print_result:
 159              	    Puts "Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹. Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ ÑÑƒÐ¼Ð¼Ð°:"
 159              	> .data
 159 00d2 D097D0B0 	>  str5:.ascii "Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹. Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ ÑÑƒÐ¼Ð¼Ð°:\n"
 159      D0B2D0B5 
 159      D180D188 
 159      D0B5D0BD 
 159      D0B8D0B5 
 159              	> 
 159              	>  strlen5 =. - str5
 159              	> 
 159              	> .text
 159 0147 B8040000 	>  movl $4,%eax
 159      00
 159 014c BB010000 	>  movl $1,%ebx
 159      00
 159 0151 B9D20000 	>  movl $str5,%ecx
 159      00
 159 0156 BA400000 	>  movl $strlen5,%edx
 159      00
 159 015b CD80     	>  int $0x80
 160 015d E87BFFFF 	    call print_current_sum
GAS LISTING task4.S 			page 7


 160      FF
 161              	    Exit $0                     # Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñƒ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾
 161 0162 B8010000 	>  movl $1,%eax
 161      00
 161 0167 BB000000 	>  movl $0,%ebx
 161      00
 161 016c CD80     	>  int $0x80
 162              	
 163              	.end
GAS LISTING task4.S 			page 8


DEFINED SYMBOLS
                             .bss:00000000 c
             task4.S:10     .bss:00000001 last_digit
             task4.S:12     .bss:00000004 output_buf
             task4.S:15     .data:00000000 sum
             task4.S:20     .text:00000000 _start
             task4.S:26     .data:00000002 str0
             task4.S:26     *ABS*:0000006b strlen0
             task4.S:28     .text:00000027 kbd_input
             task4.S:158    .text:00000147 print_result
             task4.S:49     .text:0000006d process_enter
             task4.S:78     .text:000000bb overflow_detected
             task4.S:72     .data:0000006d str2
             task4.S:72     *ABS*:00000027 strlen2
             task4.S:83     .text:000000dd print_current_sum
             task4.S:79     .data:00000094 str3
             task4.S:79     *ABS*:0000003e strlen3
             task4.S:105    .text:000000fe convert_sum_loop
             task4.S:133    .text:00000123 add_newline_sum
             task4.S:108    .text:00000103 convert_sum_loop_body
             task4.S:125    .text:00000119 extract_sum_digits
             task4.S:159    .data:000000d2 str5
             task4.S:159    *ABS*:00000040 strlen5

NO UNDEFINED SYMBOLS
