Объяснение работы макровызова Getchar

1. Что такое макрос
Макрос — это шаблон кода, который определяется один раз и может многократно использоваться в программе. Препроцессор ассемблера подставляет тело макроса в место вызова, заменяя формальные параметры на фактические.

2. Определение макроса Getchar

.macro Getchar buf_addr
    movl $3, %eax           # номер системного вызова read
    movl $0, %ebx           # дескриптор stdin (стандартный ввод)
    movl \buf_addr, %ecx    # адрес буфера для чтения
    movl $1, %edx           # количество байтов для чтения (1 байт)
    int $0x80               # программное прерывание - выполнить системный вызов
.endm
Параметры:
buf_addr — формальный параметр, адрес буфера
\buf_addr — ссылка на параметр при подстановке

3. Использование в программе
В нашей программе (строка 25):

Getchar $c

4. Раскрытие макроса
Препроцессор заменяет Getchar $c на следующий код:

movl $3, %eax       # EAX = 3 (номер системного вызова read)
movl $0, %ebx       # EBX = 0 (файловый дескриптор stdin)
movl $c, %ecx       # ECX = адрес переменной c (куда читать)
movl $1, %edx       # EDX = 1 (читаем 1 байт)
int $0x80           # выполнить системный вызов ядра Linux

5. Системный вызов read (номер 3)
Это системный вызов ядра Linux для чтения данных. Параметры передаются через регистры:
Регистр	Значение	Описание
EAX	3	Номер системного вызова read
EBX	0	Файловый дескриптор (0 = stdin)
ECX	адрес	Адрес буфера в памяти
EDX	1	Количество байтов для чтения
После выполнения int $0x80:
В EAX возвращается количество прочитанных байтов (1 при успехе, 0 при EOF)

6. Зачем нужен $ перед c

movl $c, %ecx    # ✅ Передаём АДРЕС переменной c
movl c, %ecx     # ❌ Передали бы СОДЕРЖИМОЕ переменной c
Системному вызову нужен адрес буфера, куда записать прочитанные данные, а не текущее значение переменной.

7. Преимущества использования макроса
Без макроса пришлось бы каждый раз писать 5 строк кода:

movl $3, %eax
movl $0, %ebx
movl $c, %ecx
movl $1, %edx
int $0x80
С макросом — всего одна строка:

Getchar $c
Это улучшает читаемость и упрощает поддержку кода.
Итог: Макрос Getchar — это обёртка над системным вызовом Linux read, которая читает ровно один байт из стандартного ввода в указанный буфер и возвращает статус операции в регистре EAX.
