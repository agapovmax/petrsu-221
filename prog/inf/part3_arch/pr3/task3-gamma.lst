GAS LISTING task3-gamma.S 			page 1


   1              	/*
   2              	 * ÐŸÑ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð° Ð²Ð²Ð¾Ð´Ð° ÐºÐ¾Ð´Ð¾Ð² Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ñ‹Ñ… ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð² Ð² Ð±ÑƒÑ„ÐµÑ€ Ð² ÐžÐŸ
   3              	 * ÐœÐ¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ: Ð¿Ñ€Ð¸ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¸ Enter Ð² eax Ð·Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÑ‚ÑÑ Ñ‡Ð¸ÑÐ»Ð¾Ð²
   4              	 * Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¹ Ð²Ð²ÐµÐ´ÐµÐ½Ð½Ð¾Ð¹ Ñ†Ð¸Ñ„Ñ€Ñ‹
   5              	 */
   6              	
   7              	.include "my-macro"
   1              	/*
   2              	 * ÐœÐ°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹.
   3              	 * ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
   4              	 *     - ÐºÐ¾Ð´ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹
   5              	 *
   6              	 * ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð° Ð¸Ð·Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñ‹: %e
   7              	 * Ð¡Ð¼. Ñ‚Ð°ÐºÐ¶Ðµ 'man 2 exit'
   8              	*/
   9              	.macro Exit ret_val
  10              	    movl $1, %eax         # Ð½Ð¾Ð¼ÐµÑ€ ÑÐ¸ÑÑ‚. Ð²Ñ‹Ð·Ð¾Ð²Ð° exit
  11              	    movl \ret_val, %ebx     # ÐºÐ¾Ð´ Ð²Ñ‹Ñ…Ð¾Ð´Ð°
  12              	    int $0x80         # Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð²
  13              	.endm
  14              	
  15              	
  16              	/*
  17              	 * ÐœÐ°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð±Ð°Ð¹Ñ‚Ð° ÐºÐ¾Ð´Ð° Ñ
  18              	 * ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð²Ð²Ð¾Ð´Ð°
  19              	 * ÐÐµÐºÐ°Ñ Ð°Ð±ÑÑ‚Ñ€Ð°ÐºÑ†Ð¸Ñ Ð½Ð°Ð´ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¼ Ð²Ñ‹Ð·Ð¾Ð²Ð¾Ð¼ Linux read, Ð¿Ñ€ÐµÐ´Ð½Ð
  20              	 * ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
  21              	 *     - Ð°Ð´Ñ€ÐµÑ Ð±ÑƒÑ„ÐµÑ€Ð° Ð´Ð»Ñ ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ Ð±Ð°Ð¹Ñ‚Ð°
  22              	 * Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:
  23              	 *    - Ð² %eax ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÑ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ‹Ñ… Ð±Ð°Ð¹Ñ‚Ð¾Ð²
  24              	 *    - Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ buf_addr - ÑÑ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ‹Ð¹ Ð±Ð°Ð¹Ñ‚
  25              	 *
  26              	 * ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð° Ð¸Ð·Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñ‹: %e
  27              	 * Ð¡Ð¼. Ñ‚Ð°ÐºÐ¶Ðµ 'man 2 read'
  28              	*/
  29              	.macro Getchar buf_addr
  30              	    movl $3, %eax        # Ð½Ð¾Ð¼ÐµÑ€ ÑÐ¸ÑÑ‚. Ð²Ñ‹Ð·Ð¾Ð²Ð° read
  31              	    movl $0, %ebx        # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 1: Ð´ÐµÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ñ€ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð²Ð²Ð¾
  32              	    movl \buf_addr, %ecx    # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 2: Ð°Ð´Ñ€ÐµÑ Ð±ÑƒÑ„ÐµÑ€Ð° (Ð¾Ð½ Ð¶Ðµ - Ñ„Ð°ÐºÑ‚Ð¸Ñ‡
  33              	                     # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð°)
  34              	    movl $1, %edx        # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 3: ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð±Ð°Ð¹Ñ‚Ð¾Ð² Ð´Ð»Ñ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ
  35              	    int $0x80        # Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð²
  36              	.endm
  37              	
  38              	/*
  39              	 * ÐœÐ°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ  Ð²Ñ‹Ð²Ð¾Ð´Ð° ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð² Ñ„Ð°Ð¹Ð» ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð
  40              	 * ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
  41              	 *     - Ð¡Ñ‚Ñ€Ð¾ÐºÐ° Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð°.
  42              	 *
  43              	 * ÐŸÑ€Ð¸Ð¼ÐµÑ‚Ñ€ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð°:
  44              	 *    Puts "Ð¢ÐµÐºÑÑ‚ Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ð¼Ð¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐ¸"
  45              	 *
  46              	 * Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:
  47              	 *    - Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ñ‚ Ð² ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ð¹ Ð²Ñ‹Ð²Ð¾Ð´ ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ‹ Ð·Ð°Ð´Ð°Ð½Ð½Ð¾Ð¹ ÑÑ‚Ñ€Ð
  48              	 *      Ð¸ Ð²ÑÐ»ÐµÐ´ Ð·Ð° Ð½Ð¸Ð¼Ð¸ ÑÐ¸Ð¼Ð²Ð¾Ð» Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð° ÑÑ‚Ñ€Ð¾ÐºÐ¸ \n
  49              	 *
  50              	 * ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð° Ð¸Ð·Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñ‹: %e
GAS LISTING task3-gamma.S 			page 2


  51              	 * Ð¡Ð¼. Ñ‚Ð°ÐºÐ¶Ðµ 'man puts', 'man 2 write'
  52              	*/
  53              	.macro Puts string
  54              	.data
  55              	    str\@:     .ascii "\string\n"  # Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ„Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð
  56              	
  57              	    strlen\@ =     . - str\@           # Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð´Ð»Ð¸Ð½Ñ‹ ÑÑ‚Ñ€Ð¾ÐºÐ
  58              	
  59              	.text
  60              	    movl $4, %eax        # Ð½Ð¾Ð¼ÐµÑ€ ÑÐ¸ÑÑ‚. Ð²Ñ‹Ð·Ð¾Ð²Ð° write
  61              	    movl $1, %ebx        # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 1: Ð´ÐµÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ñ€ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð²Ñ‹Ð²
  62              	    movl $str\@, %ecx    # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 2: Ð°Ð´Ñ€ÐµÑ Ð¿Ð°Ð¼ÑÑ‚Ð¸ Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ð¼Ñ‹Ð¼Ð¸ ÑÐ¸
  63              	    movl $strlen\@, %edx     # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 3: ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð±Ð°Ð¹Ñ‚Ð¾Ð² Ð´Ð»Ñ Ð²Ñ‹Ð²Ð
  64              	    int $0x80        # Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð²
  65              	.endm
   8              	
   9              	.equ BUF_SIZE, 3	# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ð¼ Ñ€Ð°Ð·Ð¼ÐµÑ€ Ð±ÑƒÑ„ÐµÑ€Ð° ÐºÐ°Ðº ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ñƒ
  10              	
  11              	.bss
  12              	    .lcomm buf, BUF_SIZE     # Ð‘ÑƒÑ„ÐµÑ€ Ð´Ð»Ñ Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ñ‹Ñ… ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²
  13              	    .lcomm c, 1              # Ð¾Ð´Ð½Ð¾Ð±Ð°Ð¹Ñ‚Ð¾Ð²Ñ‹Ð¹ Ð±ÑƒÑ„ÐµÑ€ Ð´Ð»Ñ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ Ð±Ð°Ð¹Ñ‚Ð° Ð
  14              	    .lcomm last_digit, 1     # Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¹ Ð²Ð²ÐµÐ´ÐµÐ½Ð½Ð¾Ð¹ Ñ†Ð¸Ñ„
  15              	
  16              	.text
  17              	.global _start
  18              	
  19              	_start:
  20 0000 31F6     	    xor    %esi, %esi   # ÑƒÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒ Ð°Ð´Ñ€ÐµÑÐ° Ð±Ð°Ð¹Ñ‚Ð° Ð² Ð±ÑƒÑ„ÐµÑ€Ðµ buf (Ð¸Ð½Ð´ÐµÐ
  21 0002 31C0     	    xor    %eax, %eax   # Ð¾Ñ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ eax
  22              	
  23              	show_prompt:
  24              	    Puts "Ð’Ð²Ð¾Ð´Ð¸Ñ‚Ðµ Ñ†Ð¸Ñ„Ñ€Ñƒ, Ð´Ñ€ÑƒÐ³ Ð¼Ð¾Ð¹! (Enter Ð´Ð»Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ)" 
  24              	> .data
  24 0000 D092D0B2 	>  str0:.ascii "Ð’Ð²Ð¾Ð´Ð¸Ñ‚Ðµ Ñ†Ð¸Ñ„Ñ€Ñƒ, Ð´Ñ€ÑƒÐ³ Ð¼Ð¾Ð¹! (Enter Ð´Ð»Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ)\n"
  24      D0BED0B4 
  24      D0B8D182 
  24      D0B520D1 
  24      86D0B8D1 
  24              	> 
  24              	>  strlen0 =. - str0
  24              	> 
  24              	> .text
  24 0004 B8040000 	>  movl $4,%eax
  24      00
  24 0009 BB010000 	>  movl $1,%ebx
  24      00
  24 000e B9000000 	>  movl $str0,%ecx
  24      00
  24 0013 BA500000 	>  movl $strlen0,%edx
  24      00
  24 0018 CD80     	>  int $0x80
  25              	
  26              	kbd_input:
  27              	    Getchar $c          # Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð² Ð²Ð²Ð¾Ð´Ð° Ð±Ð°Ð¹Ñ‚Ð° Ð¸Ð· stdin Ð² Ð±ÑƒÑ„ÐµÑ€ c
  27 001a B8030000 	>  movl $3,%eax
  27      00
  27 001f BB000000 	>  movl $0,%ebx
GAS LISTING task3-gamma.S 			page 3


  27      00
  27 0024 B9030000 	>  movl $c,%ecx
  27      00
  27              	>  
  27 0029 BA010000 	>  movl $1,%edx
  27      00
  27 002e CD80     	>  int $0x80
  28              	
  29 0030 83F800   	    cmpl $0, %eax       # Ð½Ð°ÑÑ‚ÑƒÐ¿Ð¸Ð»Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ EOF (ÐºÐ¾Ð½ÐµÑ† Ñ„Ð°Ð¹Ð»Ð° stdin)?
  30 0033 0F84BB00 	    je stop             # Ð”Ð° - Ð½Ð° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹
  30      0000
  31              	
  32 0039 803D0300 	    cmpb $'\n', c       # ÑÑ‚Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð» Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð° ÑÑ‚Ñ€Ð¾ÐºÐ¸ (Enter)?
  32      00000A
  33 0040 7440     	    je process_enter    # Ð”Ð - Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ðµ Enter
  34              	
  35 0042 803D0300 	    cmpb $'9', c        # ÐºÐ¾Ð´ Ð±Ð¾Ð»ÑŒÑˆÐµ ÐºÐ¾Ð´Ð° ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° '9'?
  35      000039
  36 0049 7763     	    ja print_err_msg    # Ð”Ð - Ð½Ð° Ð²Ñ‹Ð²Ð¾Ð´ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ
  37 004b 803D0300 	    cmpb $'0', c        # ÐºÐ¾Ð´ Ð¼ÐµÐ½ÑŒÑˆÐµ ÐºÐ¾Ð´Ð° ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° '0'?
  37      000030
  38 0052 725A     	    jb print_err_msg    # Ð”Ð - Ð½Ð° Ð²Ñ‹Ð²Ð¾Ð´ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ
  39              	
  40              	    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿ÐµÑ€ÐµÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð±ÑƒÑ„ÐµÑ€Ð°
  41 0054 83FE03   	    cmpl $BUF_SIZE, %esi     # ÑÑ€Ð°Ð²Ð½Ð¸Ñ‚ÑŒ Ð¸Ð½Ð´ÐµÐºÑ Ñ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð¾Ð¼ Ð±ÑƒÑ„ÐµÑ€Ð° buf
  42 0057 7D70     	    jge buffer_full          # ÐµÑÐ»Ð¸ Ð±ÑƒÑ„ÐµÑ€ Ð¿Ð¾Ð»Ð¾Ð½
  43              	
  44              	    # Ð­Ñ‚Ð¾ Ñ†Ð¸Ñ„Ñ€Ð° - ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ ÐµÐµ
  45 0059 A0030000 	    movb c, %al         # Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‚ÑŒ ÐºÐ¾Ð´ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° Ñ†Ð¸Ñ„Ñ€Ñ‹ Ð¸Ð· c Ð² al
  45      00
  46 005e 88860000 	    movb %al, buf(%esi) # ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ ÑÐ¸Ð¼Ð²Ð¾Ð» Ð² Ð±ÑƒÑ„ÐµÑ€Ðµ
  46      0000
  47 0064 A2040000 	    movb %al, last_digit # ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð²Ð²ÐµÐ´ÐµÐ½Ð½ÑƒÑŽ Ñ†Ð¸Ñ„Ñ€Ñƒ
  47      00
  48 0069 46       	    incl %esi           # ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ Ð¸Ð½Ð´ÐµÐºÑ Ð±ÑƒÑ„ÐµÑ€Ð°
  49              	    
  50              	    Puts "Ð¦Ð¸Ñ„Ñ€Ð°! Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾." # ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± ÑƒÑÐ¿ÐµÑˆÐ½Ð¾Ð¼ Ð²Ð²Ð¾Ð´Ðµ
  50              	> .data
  50 0050 D0A6D0B8 	>  str2:.ascii "Ð¦Ð¸Ñ„Ñ€Ð°! Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾.\n"
  50      D184D180 
  50      D0B02120 
  50      D0A5D0BE 
  50      D180D0BE 
  50              	> 
  50              	>  strlen2 =. - str2
  50              	> 
  50              	> .text
  50 006a B8040000 	>  movl $4,%eax
  50      00
  50 006f BB010000 	>  movl $1,%ebx
  50      00
  50 0074 B9500000 	>  movl $str2,%ecx
  50      00
  50 0079 BA1A0000 	>  movl $strlen2,%edx
  50      00
  50 007e CD80     	>  int $0x80
  51              	
GAS LISTING task3-gamma.S 			page 4


  52 0080 EB98     	    jmp kbd_input       # Ð½Ð° Ð²Ð²Ð¾Ð´ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°
  53              	
  54              	process_enter:
  55              	    # ÐŸÑ€Ð¸ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¸ Enter Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·ÑƒÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ñ†Ð¸Ñ„Ñ€Ñƒ Ð² Ñ‡Ð¸ÑÐ»Ð
  56 0082 A0040000 	    movb last_digit, %al # Ð²Ð·ÑÑ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð²Ð²ÐµÐ´ÐµÐ½Ð½ÑƒÑŽ Ñ†Ð¸Ñ„Ñ€Ñƒ
  56      00
  57 0087 2C30     	    subb $'0', %al      # Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ñ‚ÑŒ ASCII Ð² Ñ‡Ð¸ÑÐ»Ð¾ (0-9)
  58 0089 0FB6C0   	    movzbl %al, %eax    # Ñ€Ð°ÑÑˆÐ¸Ñ€Ð¸Ñ‚ÑŒ Ð´Ð¾ 32 Ð±Ð¸Ñ‚ Ð¸ Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð² eax
  59              	    
  60              	    # Ð¡Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ð´Ð»Ñ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ Ð²Ð²Ð¾Ð´Ð°
  61              	#    xor %esi, %esi      # ÑÐ±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ð¸Ð½Ð´ÐµÐºÑ Ð±ÑƒÑ„ÐµÑ€Ð°
  62 008c C6050400 	    movb $0, last_digit # ÑÐ±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ñ†Ð¸Ñ„Ñ€Ñƒ
  62      000000
  63              	
  64              	    Puts "\nÐ¦Ð¸Ñ„Ñ€Ð° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð° Ð² EAX. Ð’Ð²Ð¾Ð´Ð¸Ñ‚Ðµ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÑƒÑŽ Ñ†Ð¸Ñ„Ñ€Ñƒ..."
  64              	> .data
  64 006a 0AD0A6D0 	>  str3:.ascii "\nÐ¦Ð¸Ñ„Ñ€Ð° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð° Ð² EAX. Ð’Ð²Ð¾Ð´Ð¸Ñ‚Ðµ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÑƒÑŽ Ñ†Ð¸Ñ„Ñ€Ñƒ...\n"
  64      B8D184D1 
  64      80D0B020 
  64      D181D0BE 
  64      D185D180 
  64              	> 
  64              	>  strlen3 =. - str3
  64              	> 
  64              	> .text
  64 0093 B8040000 	>  movl $4,%eax
  64      00
  64 0098 BB010000 	>  movl $1,%ebx
  64      00
  64 009d B96A0000 	>  movl $str3,%ecx
  64      00
  64 00a2 BA570000 	>  movl $strlen3,%edx
  64      00
  64 00a7 CD80     	>  int $0x80
  65 00a9 E956FFFF 	    jmp show_prompt     # Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ðº Ð²Ð²Ð¾Ð´Ñƒ
  65      FF
  66              	
  67              	print_err_msg:
  68              	    Puts "ÐÐµ Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ð°Ñ ÐºÐ»Ð°Ð²Ð¸ÑˆÐ°. ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚Ðµ Ð²Ð²Ð¾Ð´"
  68              	> .data
  68 00c1 D09DD0B5 	>  str4:.ascii "ÐÐµ Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ð°Ñ ÐºÐ»Ð°Ð²Ð¸ÑˆÐ°. ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚Ðµ Ð²Ð²Ð¾Ð´\n"
  68      20D186D0 
  68      B8D184D1 
  68      80D0BED0 
  68      B2D0B0D1 
  68              	> 
  68              	>  strlen4 =. - str4
  68              	> 
  68              	> .text
  68 00ae B8040000 	>  movl $4,%eax
  68      00
  68 00b3 BB010000 	>  movl $1,%ebx
  68      00
  68 00b8 B9C10000 	>  movl $str4,%ecx
  68      00
  68 00bd BA420000 	>  movl $strlen4,%edx
  68      00
GAS LISTING task3-gamma.S 			page 5


  68 00c2 CD80     	>  int $0x80
  69 00c4 E951FFFF 	    jmp kbd_input       # Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ Ð²Ð²Ð¾Ð´
  69      FF
  70              	
  71              	buffer_full:
  72              	    # Ð‘ÑƒÑ„ÐµÑ€ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½ - Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ð¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¸ Ð·Ð°Ð²ÐµÑ€ÑˆÐ°ÐµÐ¼ Ð¿Ñ€Ð¾Ð
  73              	    Puts "\nÐ‘ÑƒÑ„ÐµÑ€ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½! ÐŸÑ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð° Ð·Ð°Ð²ÐµÑ€ÑˆÐ°ÐµÑ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ."
  73              	> .data
  73 0103 0AD091D1 	>  str5:.ascii "\nÐ‘ÑƒÑ„ÐµÑ€ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½! ÐŸÑ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð° Ð·Ð°Ð²ÐµÑ€ÑˆÐ°ÐµÑ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ.\n"
  73      83D184D0 
  73      B5D18020 
  73      D0B7D0B0 
  73      D0BFD0BE 
  73              	> 
  73              	>  strlen5 =. - str5
  73              	> 
  73              	> .text
  73 00c9 B8040000 	>  movl $4,%eax
  73      00
  73 00ce BB010000 	>  movl $1,%ebx
  73      00
  73 00d3 B9030100 	>  movl $str5,%ecx
  73      00
  73 00d8 BA520000 	>  movl $strlen5,%edx
  73      00
  73 00dd CD80     	>  int $0x80
  74 00df EB00     	    jmp stop_with_message
  75              	
  76              	stop_with_message:
  77              	    # Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ñ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÐµÐ¼ Ð¾ Ð¿ÐµÑ€ÐµÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ð¸
  78              	    # Ð’ EAX ÑƒÐ¶Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¹ Ñ†Ð¸Ñ„Ñ€Ñ‹ (ÐµÑÐ»Ð¸ 
  79 00e1 803D0400 	    cmpb $0, last_digit
  79      000000
  80 00e8 741D     	    je exit_without_digit
  81 00ea A0040000 	    movb last_digit, %al
  81      00
  82 00ef 2C30     	    subb $'0', %al
  83 00f1 0FB6C0   	    movzbl %al, %eax
  84              	
  85              	stop:
  86              	    # Ð•ÑÐ»Ð¸ Ð±Ñ‹Ð»Ð° Ð²Ð²ÐµÐ´ÐµÐ½Ð° Ñ†Ð¸Ñ„Ñ€Ð° Ð¿ÐµÑ€ÐµÐ´ EOF, Ñ‚Ð¾Ð¶Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÐ¼ ÐµÐ
  87 00f4 803D0400 	    cmpb $0, last_digit
  87      000000
  88 00fb 7416     	    je exit_program
  89 00fd A0040000 	    movb last_digit, %al
  89      00
  90 0102 2C30     	    subb $'0', %al
  91 0104 0FB6C0   	    movzbl %al, %eax
  92              	
  93              	exit_without_digit:
  94              	    Exit $1             # Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ñ ÐºÐ¾Ð´Ð¾Ð¼ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ 1 Ñ‚Ð°Ðº ÐºÐ°Ðº Ð¿ÐµÑ€ÐµÐ
  94 0107 B8010000 	>  movl $1,%eax
  94      00
  94 010c BB010000 	>  movl $1,%ebx
  94      00
  94 0111 CD80     	>  int $0x80
  95              	
GAS LISTING task3-gamma.S 			page 6


  96              	exit_program:
  97              	    Exit $0
  97 0113 B8010000 	>  movl $1,%eax
  97      00
  97 0118 BB000000 	>  movl $0,%ebx
  97      00
  97 011d CD80     	>  int $0x80
  98              	
  99              	.end
GAS LISTING task3-gamma.S 			page 7


DEFINED SYMBOLS
       task3-gamma.S:9      *ABS*:00000003 BUF_SIZE
       task3-gamma.S:12     .bss:00000000 buf
       task3-gamma.S:12     .bss:00000003 c
       task3-gamma.S:13     .bss:00000004 last_digit
       task3-gamma.S:19     .text:00000000 _start
       task3-gamma.S:23     .text:00000004 show_prompt
       task3-gamma.S:24     .data:00000000 str0
       task3-gamma.S:24     *ABS*:00000050 strlen0
       task3-gamma.S:26     .text:0000001a kbd_input
       task3-gamma.S:85     .text:000000f4 stop
       task3-gamma.S:54     .text:00000082 process_enter
       task3-gamma.S:67     .text:000000ae print_err_msg
       task3-gamma.S:71     .text:000000c9 buffer_full
       task3-gamma.S:50     .data:00000050 str2
       task3-gamma.S:50     *ABS*:0000001a strlen2
       task3-gamma.S:64     .data:0000006a str3
       task3-gamma.S:64     *ABS*:00000057 strlen3
       task3-gamma.S:68     .data:000000c1 str4
       task3-gamma.S:68     *ABS*:00000042 strlen4
       task3-gamma.S:73     .data:00000103 str5
       task3-gamma.S:73     *ABS*:00000052 strlen5
       task3-gamma.S:76     .text:000000e1 stop_with_message
       task3-gamma.S:93     .text:00000107 exit_without_digit
       task3-gamma.S:96     .text:00000113 exit_program

NO UNDEFINED SYMBOLS
